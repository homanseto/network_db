version: "3.9"

services:

  api:
    volumes:
      - ./api/app:/app/app
    command: >
      python -Xfrozen_modules=off -m debugpy
      --listen 0.0.0.0:5678
      --wait-for-client
      -m uvicorn app.main:app
      --host 0.0.0.0
      --port 8000
      --reload
    # command: >
    #   python -m debugpy --listen 0.0.0.0:5678
    #   -m uvicorn app.main:app
    #   --host 0.0.0.0
    #   --port 8000
    #   --reload
    ports:
      - "8000:8000"
      - "5678:5678"

  postgis:
    ports:
      - "5433:5432"


# Prevents app from starting until VSCode attaches. Guarantees debugger hooks correctly. 
# Attach to subprocesses too, Without this, reload child process wonâ€™t be debugged.